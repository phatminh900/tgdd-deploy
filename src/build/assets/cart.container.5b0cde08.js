import{r as p,m as $,n as f,j as s,a as t,k as I,L as q,e as D,Q as M,o as B,p as y,B as Q,b as L,q as z,F as A,t as N,c as H,M as V,v as G,w as R,x as k,y as J,d as F,J as T,z as K,R as W}from"./index.2f4aceee.js";const X="_active_12qhq_50",o={"cart-item":"_cart-item_12qhq_1","cart-item__left":"_cart-item__left_12qhq_8","cart-item__info":"_cart-item__info_12qhq_20","cart-item__img-box":"_cart-item__img-box_12qhq_24","cart-item__btn-remove":"_cart-item__btn-remove_12qhq_28","cart-item__img":"_cart-item__img_12qhq_24","cart-item__promotion-list":"_cart-item__promotion-list_12qhq_40",active:X,"cart-item__btn-promotion":"_cart-item__btn-promotion_12qhq_53","cart-item__btn-color":"_cart-item__btn-color_12qhq_60","cart-item__colors":"_cart-item__colors_12qhq_63","cart-item__colors-list":"_cart-item__colors-list_12qhq_66","cart-item__right":"_cart-item__right_12qhq_122"},Y=(r,e)=>{const[c,a]=p.exports.useState(e||1),[n,l]=p.exports.useState(!1),[u,m]=p.exports.useState(!1),i=$();return{quantity:c,changeQuantityItem:_=>{a(_),i(f.changeCurrentQuantityProduct({id:r,quantity:_}))},isOpenPromotionList:n,isOpenColorList:u,changeCurrentColor:_=>{i(f.changeCurrentColorProduct({id:r,color:_})),m(!1)},togglePromotionList:()=>l(_=>!_),removeItem:()=>{i(f.removeFromCart({id:r}))},toggleColorList:()=>m(_=>!_)}},Z=({currentProductColor:r,color:e,imgSrc:c,changeCurrentColor:a})=>s("li",{onClick:()=>a(e),className:`${o["cart-item__colors-item"]} ${r===e&&o.active} flex-vt-ct`,children:[t("img",{height:30,width:30,src:c,alt:"product color"}),t("p",{"data-testid":"cart-item-color",children:e})]}),tt=({isOpenColorList:r,imgColorsCover:e,changeCurrentColor:c,currentColor:a,colors:n})=>t("ul",{"data-testid":"cart-item-color-list",className:`${o["cart-item__colors-list"]} ${r&&o.active}`,children:e.map((l,u)=>t(Z,{color:n[u],imgSrc:l,changeCurrentColor:c,currentProductColor:a},l))}),et=({toggleColorList:r,currentColor:e})=>s("button",{className:`${o["cart-item__btn-color"]} gap-6px flex-vt-ct`,onClick:r,children:["M\xE0u:",e," ",t(I,{})]}),rt=({isOpenPromotionList:r,promotion:e,togglePromotionList:c})=>s("div",{className:`${o["cart-item__promotion"]} `,children:[t("ul",{className:`${o["cart-item__promotion-list"]} ${r&&o.active}`,children:e==null?void 0:e.map(a=>t("li",{children:a},a))}),s("button",{className:`${o["cart-item__btn-promotion"]} ${r&&o.active} flex-vt-ct`,onClick:c,children:[r?"Thu g\u1ECDn":e!=null&&e.length?`Xem  ${e.length} khuy\u1EBFn m\xE3i`:"",e!=null&&e.length?t(I,{}):""]})]}),at=({link:r,currentColorImgCover:e,removeItem:c})=>s("div",{className:`${o["cart-item__img-box"]} flex-vt-ct gap-12px`,children:[t(q,{to:r,children:t("img",{height:65,width:65,"data-testid":"cart-item-img-cover",className:o["cart-item__img"],src:e,alt:"Product"})}),t("button",{onClick:c,className:o["cart-item__btn-remove"],children:"\xD7"})]}),ct=({currentColor:r,title:e,link:c,quantity:a,price:n,imgColorsCover:l,currentColorImgCover:u,colors:m,id:i,promotion:d})=>{const{quantity:v,changeQuantityItem:h,isOpenPromotionList:x,isOpenColorList:g,changeCurrentColor:_,togglePromotionList:S,removeItem:O,toggleColorList:U}=Y(i,a);return s("li",{"data-testid":`cart-item-container-${i}`,className:o["cart-item"],children:[t("div",{className:o["cart-item__left"],children:s("div",{className:`${o["cart-item__info"]} flex`,children:[t(at,{removeItem:O,link:c,currentColorImgCover:u}),s("div",{children:[t(q,{to:c,children:t("h4",{children:e})}),t(rt,{togglePromotionList:S,promotion:d,isOpenPromotionList:x}),s("div",{className:o["cart-item__colors"],children:[t(et,{toggleColorList:U,currentColor:r}),t(tt,{isOpenColorList:g,colors:m,currentColor:r,changeCurrentColor:_,imgColorsCover:l})]})]})]})}),s("div",{className:o["cart-item__right"],children:[t(D,{price:n}),t(M,{quantity:v,changeQuantityItem:h})]})]})},j=()=>B(e=>e.cart.cart),st={},nt=()=>{const r=j();return t("ul",{"data-testid":"cart-list",className:st.cart__list,children:r.map(e=>t(ct,{...e},e.id+e.currentColor))})},ot="_cart_1bhi1_13",it="_cart__header_1bhi1_29",lt="_cart__body_1bhi1_38",b={cart:ot,cart__header:it,cart__body:lt,"cart__user-login":"_cart__user-login_1bhi1_50"},_t=()=>({totalPrice:y().cart.reduce((c,a)=>a.price*a.quantity+c,0)}),ut="_summary_12r0z_1",dt="_total_12r0z_5",P={summary:ut,total:dt},mt=({checkout:r})=>{const e=y(),{totalPrice:c}=_t();return s("div",{"data-testid":"cart-summary-container",className:P.summary,children:[s("div",{className:`${P.total} flex-vt-ct`,children:[t("p",{className:"text-bold",children:"T\u1ED5ng ti\u1EC1n "}),t(D,{price:e.priceAfterApplyingDiscount||c})]}),t(Q,{btnType:"primary",onClick:r,children:" Mua ngay"})]})},ht="_cart__form_1djeg_6",C={"cart__user-info":"_cart__user-info_1djeg_1",cart__form:ht,"cart__input-error":"_cart__input-error_1djeg_27"},gt=()=>{var m;const r=(m=L())==null?void 0:m.user,e=$(),c=B(z),{userAddress:a}=y(),[n,l]=p.exports.useState(a||"");return{user:r,address:n,setUserAddress:i=>{const{value:d}=i.target;e(f.setUserAddress({address:d})),l(d)},appState:c}},pt=()=>{const{user:r,address:e,setUserAddress:c,appState:a}=gt();return r?s("div",{className:C["cart__user-info"],children:[t("p",{children:"Th\xF4ng tin kh\xE1ch h\xE0ng"}),s("form",{"data-error-msg":a.error,className:`${C.cart__form} gap-12px`,children:[s(A,{children:[t(N,{type:"text",label:"name",id:"user-name",value:r.name,className:` ${a.error&&!r.name&&C["cart__input-error"]}`}),t(N,{className:`${C["cart__user-email-input"]} ${a.error&&!r.email&&C["cart__input-error"]}`,disable:!0,value:r.email,label:"Email",id:"user-login-email",type:"email"})]}),t(N,{onChange:c,className:a.error&&!e?C["cart__input-error"]:"",label:"Address",id:"address",value:e,type:"text"})]})]}):null},vt="_cart__nothing_1njkf_1",w={cart__nothing:vt,"cart__nothing--details":"_cart__nothing--details_1njkf_5"},xt=()=>{const r=H();return t("div",{className:w.cart__nothing,children:s("div",{className:w["cart__nothing--details"],children:[t(V,{}),t("p",{children:"Kh\xF4ng c\xF3 s\u1EA3n ph\u1EA9m n\xE0o trong gi\u1ECF h\xE0ng"}),t("button",{className:"btn--border-blue",onClick:()=>r("/"),children:"V\u1EC1 trang ch\u1EE7"})]})})},Ct="_cart__discount_ublfd_1",E={cart__discount:Ct,"cart__btn-control":"_cart__btn-control_ublfd_6","cart__discount-box":"_cart__discount-box_ublfd_12","cart__btn-apply":"_cart__btn-apply_ublfd_32"};function yt(r){return G({tag:"svg",attr:{viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"desc",attr:{},child:[]},{tag:"path",attr:{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}},{tag:"line",attr:{x1:"9",y1:"15",x2:"15",y2:"9"}},{tag:"circle",attr:{cx:"9.5",cy:"9.5",r:".5",fill:"currentColor"}},{tag:"circle",attr:{cx:"14.5",cy:"14.5",r:".5",fill:"currentColor"}},{tag:"path",attr:{d:"M5 7.2a2.2 2.2 0 0 1 2.2 -2.2h1a2.2 2.2 0 0 0 1.55 -.64l.7 -.7a2.2 2.2 0 0 1 3.12 0l.7 .7a2.2 2.2 0 0 0 1.55 .64h1a2.2 2.2 0 0 1 2.2 2.2v1a2.2 2.2 0 0 0 .64 1.55l.7 .7a2.2 2.2 0 0 1 0 3.12l-.7 .7a2.2 2.2 0 0 0 -.64 1.55v1a2.2 2.2 0 0 1 -2.2 2.2h-1a2.2 2.2 0 0 0 -1.55 .64l-.7 .7a2.2 2.2 0 0 1 -3.12 0l-.7 -.7a2.2 2.2 0 0 0 -1.55 -.64h-1a2.2 2.2 0 0 1 -2.2 -2.2v-1a2.2 2.2 0 0 0 -.64 -1.55l-.7 -.7a2.2 2.2 0 0 1 0 -3.12l.7 -.7a2.2 2.2 0 0 0 .64 -1.55v-1"}}]})(r)}const ft=()=>{const r=$(),e=y(),a=e.cart[0].discount,[n,l]=p.exports.useState(!0),[u,m]=p.exports.useState(0),[i,d]=p.exports.useState(e.discountCode||""),[v,h]=p.exports.useState(!1),x=g=>{g.preventDefault();const _=a==null?void 0:a.find(S=>S.code===i);if(!_)return l(!1);l(!0),m(_.discount),r(f.applyDiscount({discountCode:i,discount:_.discount}))};return s("div",{className:E.cart__discount,children:[s("button",{onClick:()=>h(g=>!g),className:`${E["cart__btn-control"]} flex-vt-ct gap-8px`,children:[t(yt,{})," S\u1EED d\u1EE5ng m\xE3 gi\u1EA3m gi\xE1"," ",v?t(R,{}):t(I,{})]}),t("form",{"data-invalid-discount":n?"":"Invalid discount",onSubmit:x,className:`${E["cart__discount-box"]} flex gap-12px`,children:v&&s(A,{children:[t(N,{id:"Discount-place",label:u&&n?`Gi\u1EA3m ${u}%`:"Nh\u1EADp m\xE3 gi\u1EA3m gi\xE1",value:i,onChange:g=>d(g.target.value),type:"text"}),t("div",{children:t("button",{className:E["cart__btn-apply"],type:"submit",children:"Apply"})})]})})]})},bt=()=>{const r=j(),e=r.reduce((a,n)=>a+n.quantity,0),c=r.reduce((a,n)=>a+n.price*n.quantity,0);return{totalProducts:e,totalPrice:c}},Et="_cart__summary_9yopw_1",Nt={cart__summary:Et},qt=()=>{const{totalProducts:r,totalPrice:e}=bt();return s("div",{className:`${Nt.cart__summary} flex-vt-ct`,children:[s("p",{children:["T\u1EA1m t\xEDnh (",r,") s\u1EA3n ph\u1EA9m:"]}),t(D,{price:e})]})},At=()=>{var i;const r=y().cart,e=(i=L())==null?void 0:i.user,c=y(),a=$(),{discount:n,userAddress:l}=c,u=e?e._id:null;return{cart:r,checkout:async()=>{try{if(!l)return a(k.setError("Please fill up all the fields."));const{data:d}=await J.post("/api/v1/booking/create-checkout-session",{cart:r,discount:n,userAddress:l,userId:u},{headers:{Authorization:`Bearer ${F.get(T)}`}});a(k.resetState()),window.location.href=d.session.url}catch(d){const v=d,{response:h}=v,x=(h==null?void 0:h.data.message)||"something went wrong";a(k.setError(x))}}}},St=()=>{var n;const r=(n=L())==null?void 0:n.user,{cart:e,checkout:c}=At(),a=s(A,{children:[s("div",{className:`${b.cart__header} flex-vt-ct`,children:[s(q,{to:"/",children:[t(K,{})," Xem th\xEAm s\u1EA3n ph\u1EA9m kh\xE1c"]}),t("p",{children:"Your cart"})]}),s("div",{className:b.cart__body,children:[t(nt,{}),t(qt,{}),r&&F.get(T)?s(A,{children:[t(pt,{}),t(ft,{}),t(mt,{checkout:c})]}):s("div",{className:b["cart__user-login"],children:[t("p",{children:"Please login first to purchase."}),t(q,{to:W.LOGIN,children:"Login Here"})]})]})]});return t("div",{className:b.cart,children:e.length?a:t(xt,{})})};export{St as default};
